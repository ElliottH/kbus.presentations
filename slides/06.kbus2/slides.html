<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<meta name="version" content="S5 1.1" />
<title>Why KBUS?</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 5196 2007-06-03 20:25:28Z wiemann $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<script src="ui/small-white/slides.js" type="text/javascript"></script>
<link rel="stylesheet" href="ui/small-white/slides.css"
      type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="ui/small-white/outline.css"
      type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="ui/small-white/print.css"
      type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="ui/small-white/opera.css"
      type="text/css" media="projection" id="operaFix" />

<style type="text/css">
#currentSlide {display: none;}
</style>
</head>
<body>
<div class="layout">
<div id="controls"></div>
<div id="currentSlide"></div>
<div id="header">

</div>
<div id="footer">
<h1>Why KBUS?</h1>
<h2>CamPUG 2nd March 2010</h2>
</div>
</div>
<div class="presentation">
<div class="slide" id="slide0">
<h1 class="title">Why KBUS?</h1>

<!-- Definitions of interpreted text roles (classes) for S5/HTML data. -->
<!-- This data file has been placed in the public domain. -->
<!-- Colours
======= -->
<!-- Text Sizes
========== -->
<!-- Display in Slides (Presentation Mode) Only
========================================== -->
<!-- Display in Outline Mode Only
============================ -->
<!-- Display in Print Only
===================== -->
<!-- Display in Handout Mode Only
============================ -->
<!-- Incremental Display
=================== -->
<p class="center">Tony Ibbs</p>
<p class="center"><a class="reference external" href="mailto:tibs&#64;tonyibbs.co.uk">tibs&#64;tonyibbs.co.uk</a></p>
<p class="center">Why not some other messaging system?</p>

</div>
<div class="slide" id="what-kbus-is">
<h1>What KBUS is</h1>
<p>A lightweight messaging system for Linux, particularly aimed at embedded platforms.</p>
<p>Message passing is managed by a kernel module, via reading/writing
<tt class="docutils literal"><span class="pre">/dev/kbus0</span></tt> style devices.</p>
<p>Python bindings are provided, as is a C library.</p>
</div>
<div class="slide" id="what-we-want">
<h1>What we want</h1>
<p>Reliability.</p>
<p>Simplicity.</p>
</div>
<div class="slide" id="previous-experience">
<h1>Previous experience</h1>
<ul class="simple">
<li>Communication between a browser and user processes.</li>
<li>Race conditions when either crashes and restarts.</li>
<li>Unreliable implementation (frustrating when you're not allowed to fix it).</li>
<li>Poor documentation (well, some of that was fixable).</li>
</ul>
</div>
<div class="slide" id="aims">
<h1>Aims</h1>
<ul class="simple">
<li>Predictable delivery.</li>
<li>Deterministic message ordering (per KBUS device).</li>
<li><em>Always</em> get a reply to a request.</li>
<li>Simple models to &quot;think with&quot;.</li>
<li>Works in the embedded environment (small, works with just C).</li>
</ul>
</div>
<div class="slide" id="predictable-delivery">
<h1>Predictable delivery</h1>
<p>It is acceptable for a Listener to miss messages (but there are ways around
that).</p>
<p>But a Replier never shall.</p>
<p>And each Request shall produce a Reply.</p>
</div>
<div class="slide" id="predictable-delivery-1">
<h1>Predictable delivery (1)</h1>
<p>If a sender attempts to send a Request, but does not have room on its message
queue for the (corresponding) Reply, then the message will not be sent, and
the send will fail.</p>
</div>
<div class="slide" id="predictable-delivery-2">
<h1>Predictable delivery (2)</h1>
<p>If a replier cannot receive a particular message, because its queue is full,
then the message will not be sent, and the send will fail with an error.</p>
</div>
<div class="slide" id="predictable-delivery-3">
<h1>Predictable delivery (3)</h1>
<p>If a message has the ALL_OR_FAIL flag set, then a send will only succeed if
the message could be added to all the (intended) recipient’s message queues
(listeners as well).  Otherwise, send returns -EBUSY.</p>
<p><em>(Primarily for use in debugging systems, we think)</em></p>
</div>
<div class="slide" id="predictable-delivery-4">
<h1>Predictable delivery (4)</h1>
<p>If a message has the ALL_OR_WAIT flag set, then a send will only succeed if
the message could be added to all the (intended) recipient’s message queues
(listeners as well).  Otherwise send returns -EAGAIN.</p>
<p>(The sender then needs to discard the message, or play the poll/select game to
wait for the send to finish).</p>
<p><em>(Primarily for use in debugging systems, we think)</em></p>
</div>
<div class="slide" id="always-get-a-reply">
<h1>Always get a reply</h1>
<blockquote>
&quot;&quot;&quot;KBUS guarantees that each Request will (eventually) be matched by a
consequent Reply (or Status) message, and only one such.&quot;&quot;&quot;</blockquote>
<p>If the replier can't give a Reply, KBUS will (e.g.,
&quot;<tt class="docutils literal"><span class="pre">$.KBUS.Replier.Unbound</span></tt>&quot; or &quot;<tt class="docutils literal"><span class="pre">$.KBUS.ReplierGoneAway</span></tt>&quot;).</p>
</div>
<div class="slide" id="simple-models">
<h1>Simple models</h1>
<ul class="simple">
<li>KBUS devices.</li>
<li>Ksocks implemented with file operations - <tt class="docutils literal"><span class="pre">open</span></tt>, <tt class="docutils literal"><span class="pre">read</span></tt>, <tt class="docutils literal"><span class="pre">write</span></tt>,
<tt class="docutils literal"><span class="pre">close</span></tt> and IOCTLs.</li>
<li>Senders, Listeners, Repliers.</li>
<li>Announcements, Requests, Replies.</li>
<li>Message names, <tt class="docutils literal"><span class="pre">to</span></tt> and <tt class="docutils literal"><span class="pre">from</span></tt>, <tt class="docutils literal"><span class="pre">in_reply_to</span></tt>, etc.</li>
</ul>
</div>
<div class="slide" id="kernel-module-1">
<h1>Kernel module (1)</h1>
<p>Using a kernel module means:</p>
<ul class="simple">
<li>we can have a file interface</li>
<li>we can tell when a Listener &quot;goes away&quot; (including falling over)</li>
<li>we can have a real expectation of our &quot;daemon&quot; not crashing</li>
<li>we get to use relatively sophisticated and proven datastructures</li>
</ul>
</div>
<div class="slide" id="kernel-module-2">
<h1>Kernel module (2)</h1>
<p>Using a kernel module means:</p>
<ul class="simple">
<li>the kernel hides a lot of the complicated stuff (both at the top and bottom
level) from us, so we can't do it wrong(!)</li>
<li>we get less context switching, and arguably better parallelism</li>
</ul>
</div>
<div class="slide" id="names-for-things">
<h1>Names for things</h1>
<p>I hope the names (Listener, Sender, Request, etc.) are simple and easy to
understand.</p>
<p>Ksock is a compromise (it's better than &quot;Elephant&quot;).</p>
<p>Sorry about Limpets.</p>
</div>
<div class="slide" id="messages">
<h1>Messages</h1>
<p>KBUS defines the message structure, but does not say anything about its
content.</p>
<blockquote>
(hmm: future ASN.1 and XMPP support, maybe - &quot;not quite KBUS&quot;)</blockquote>
<p>The fields in the header aim to be easy to understand, and <em>just</em> the fields
we need.</p>
</div>
<div class="slide" id="example-uses">
<h1>Example uses</h1>
<ul class="simple">
<li>Video recording - start/stop/play from decoder to recorder</li>
<li>Industrial control systems - different processes communicating</li>
<li>Remote control and telemetry</li>
</ul>
</div>
<div class="slide" id="are-we-pythonic-yet">
<h1>Are we Pythonic yet?</h1>
<p>Well, it's an aim.</p>
<pre class="literal-block">
&gt;&gt;&gt; import this
</pre>
<!-- rejig the margin

*(the next few slides are not meant to be dwelt over!)* -->
</div>
<div class="slide" id="import-this-1">
<h1>import this (1)</h1>
<ul class="simple">
<li>Beautiful is better than ugly.</li>
</ul>
<p>I can't really judge that, as I'm too close!</p>
</div>
<div class="slide" id="import-this-2">
<h1>import this (2)</h1>
<ul class="simple">
<li>Explicit is better than implicit.</li>
<li>Simple is better than complex.</li>
<li>Complex is better than complicated.</li>
</ul>
<p>Messaging is complex, we try not to make it complicated to do.</p>
<p>We also try to implement only what we need, not &quot;other stuff that might be
useful&quot;.</p>
</div>
<div class="slide" id="import-this-3">
<h1>import this (3)</h1>
<ul class="simple">
<li>Flat is better than nested.</li>
</ul>
<p>I think KBUS is a &quot;flat&quot; system.</p>
<ul class="simple">
<li>Sparse is better than dense.</li>
</ul>
<p>OK... not sure how that applies.</p>
</div>
<div class="slide" id="import-this-4">
<h1>import this (4)</h1>
<ul class="simple">
<li>Readability counts.</li>
</ul>
<p>Again, you'll have to judge - I hope we're making a system that helps provide
readable code.</p>
</div>
<div class="slide" id="import-this-5">
<h1>import this (5)</h1>
<ul class="simple">
<li>Special cases aren't special enough to break the rules.</li>
<li>Although practicality beats purity.</li>
</ul>
<p>That's a difficult balance to judge - we're trying.</p>
</div>
<div class="slide" id="import-this-6">
<h1>import this (6)</h1>
<ul class="simple">
<li>Errors should never pass silently.</li>
<li>Unless explicitly silenced.</li>
</ul>
<p>These definitely <em>are</em> KBUS aims.</p>
</div>
<div class="slide" id="import-this-7">
<h1>import this (7)</h1>
<ul class="simple">
<li>In the face of ambiguity, refuse the temptation to guess.</li>
<li>There should be one-- and preferably only one --obvious way to do it.</li>
<li>Although that way may not be obvious at first unless you're Dutch.</li>
<li>Now is better than never.</li>
<li>Although never is often better than <em>right</em> now.</li>
</ul>
<p>Hmm.</p>
</div>
<div class="slide" id="import-this-8">
<h1>import this (8)</h1>
<ul class="simple">
<li>If the implementation is hard to explain, it's a bad idea.</li>
<li>If the implementation is easy to explain, it may be a good idea.</li>
</ul>
<p><em>Of course</em> these apply - I hope we're getting the balance right.</p>
</div>
<div class="slide" id="import-this-9">
<h1>import this (9)</h1>
<ul class="simple">
<li>Namespaces are one honking great idea -- let's do more of those!</li>
</ul>
<p>Erm...</p>
<p>(KBUS appears to be noticeably lacking in the namespaces arena)</p>
</div>
<div class="slide" id="why-not-use">
<h1>Why not use?</h1>
<p>What else could we have used?</p>
<p>It needs to be:</p>
<ul class="simple">
<li>open source</li>
<li>well maintained</li>
<li>run on Linux in an embedded environment (so preferably not too large, and
it must available in a C implementation)</li>
</ul>
</div>
<div class="slide" id="dbus">
<h1>DBUS</h1>
<ul class="simple">
<li>I don't understand it (over complex model, no quick way in, way too much
terminology - I may be biassed)</li>
<li>Socket oriented (not a kernel module) so can't tell when clients fall over</li>
<li>No deterministic message ordering</li>
<li>I am told it is not all reliable...</li>
<li>...or implemented</li>
<li>It's big</li>
</ul>
</div>
<div class="slide" id="the-kernel-module-thing">
<h1>The &quot;kernel module&quot; thing</h1>
<p>So, OK, I would like to have a user-space KBUS daemon available. Which would
then gain some of the problems that things like DBUS share (crashing and
restarting issues, for a start). But we'd be aiming to make it behave with the
same APIs and expectations as the kernel module implementation.</p>
<p>So that's OK then.</p>
</div>
<div class="slide" id="zeromq-0mq">
<h1>zeromq / 0mq</h1>
<ul class="simple">
<li>aiming for speed</li>
<li>and scalability</li>
<li>messages are simpler than we want (not <em>really</em> a problem?)</li>
<li><em>not</em> aiming for the sort of &quot;predicability&quot; we're after (I believe)</li>
<li>very cross platform</li>
</ul>
</div>
<div class="slide" id="zeromq-0mq-continue">
<h1>zeromq / 0mq continue</h1>
<p>This looks like one it would be fun to play with, and I definitely need to
learn more about it.</p>
<p>It might be useful as a transport mechanism for KBUS messages over the net...</p>
</div>
<div class="slide" id="what-else">
<h1>What else?</h1>
<p>Ideas would be welcome.</p>
<p>(I'm ignoring many &quot;enterprise space&quot; systems, which often do seek guarantees
of delivery, but at the cost of being an enterprise system.)</p>
<!-- vim: set filetype=rest tabstop=8 shiftwidth=2 expandtab: -->
</div>
</div>
</body>
</html>
